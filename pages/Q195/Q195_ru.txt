Whirlpool — криптографическая хеш-функция, разработанная Винсентом Рэйменом и Пауло Баррето. Опубликована в ноябре 2000 года. Хеширует входное сообщение с длиной до 
  
    
      
        
          2
          
            256
          
        
      
    
    {\displaystyle 2^{256}}
  
 битов. Выходное значение хеш-функции Whirlpool, называемое хешем, составляет 512 битов.


== История ==


=== Название ===

Хеш-функция Whirlpool названа в честь Галактики Водоворот (M51) в созвездии Гончие Псы — первой галактики с наблюдаемой спиральной структурой.


=== Модификации ===
С момента создания в 2000 году Whirlpool дважды модифицировалась.
Первая версия, Whirlpool-0, представлена как кандидат в проекте NESSIE (англ. New European Schemes for Signatures, Integrity and Encryption, новые европейские проекты по цифровой подписи, целостности и шифрованию).
Модификация Whirlpool-0, названная Whirlpool-T, в 2003 году добавлена в перечень рекомендованных к использованию криптографических функций NESSIE. Изменения касались блока подстановки (S-box) Whirlpool: в первой версии структура S-box не была описана, и он генерировался произвольно, что создавало определённые проблемы при аппаратной реализации Whirlpool. В версии Whirlpool-T S-box «приобрёл» чёткую структуру.
Дефект в диффузных матрицах Whirlpool-T, обнаруженный Тайдзо Сираем и Кёдзи Сибутани, впоследствии исправлен, и конечная (третья) версия, названная для краткости просто Whirlpool, принята ISO в стандарте ISO/IEC 10118-3:2004 в 2004 году.


== Описание ==
Основная версия — хеш-функции — третья; в отличие от первой версии, S-box определён, а диффузная матрица заменена на новую после доклада Сирая и Сибутани.
Whirlpool состоит из повторного применения функции сжатия, основой которой является специальный 512-битный блочный шифр 
  
    
      
        W
      
    
    {\displaystyle W}
  
 с 512-битным ключом.
В алгоритме используются операции в поле Галуа 
  
    
      
         
        G
        F
        (
        
          2
          
            8
          
        
        )
      
    
    {\displaystyle \ GF(2^{8})}
  
 по модулю неприводимого многочлена 
  
    
      
         
        
          p
          
            8
          
        
        (
        x
        )
        =
        
          x
          
            8
          
        
        +
        
          x
          
            4
          
        
        +
        
          x
          
            3
          
        
        +
        
          x
          
            2
          
        
        +
        1
      
    
    {\displaystyle \ p_{8}(x)=x^{8}+x^{4}+x^{3}+x^{2}+1}
  
.
Многочлены для краткости записываются в шестнадцатеричном представлении. Например, запись 
  
    
      
         
        11
        
          D
          
            x
          
        
      
    
    {\displaystyle \ 11D_{x}}
  
 означает 
  
    
      
         
        
          p
          
            8
          
        
        (
        x
        )
      
    
    {\displaystyle \ p_{8}(x)}
  
.

Символом 
  
    
      
        ∘
      
    
    {\displaystyle \circ }
  
 обозначается оператор композиции. Выражение 
  
    
      
        f
        ∘
        g
      
    
    {\displaystyle f\circ g}
  
 означает композицию функций 
  
    
      
         
        g
      
    
    {\displaystyle \ g}
  
 и 
  
    
      
         
        f
      
    
    {\displaystyle \ f}
  
.
Для обозначения композиции последовательности функций 
  
    
      
        
          f
          
            m
          
        
        ,
        
          f
          
            m
            +
            1
          
        
        ,
        .
        .
        .
        ,
        
          f
          
            n
            −
            1
          
        
        ,
        
          f
          
            n
          
        
        ,
        m
        ≤
        n
      
    
    {\displaystyle f_{m},f_{m+1},...,f_{n-1},f_{n},m\leq n}
  
 используется символ 
  
    
      
        
          ◯
          
            m
          
          
            r
            =
            n
          
        
      
    
    {\displaystyle \bigcirc _{m}^{r=n}}
  
:

  
    
      
        
          ◯
          
            m
          
          
            r
            =
            n
          
        
        
          f
          
            r
          
        
        ≡
        
          f
          
            n
          
        
        ∘
        
          f
          
            n
            −
            1
          
        
        ∘
        ⋯
        ∘
        
          f
          
            m
            +
            1
          
        
        ∘
        
          f
          
            m
          
        
        .
      
    
    {\displaystyle \bigcirc _{m}^{r=n}f_{r}\equiv f_{n}\circ f_{n-1}\circ \dots \circ f_{m+1}\circ f_{m}.}
  

  
    
      
        
          M
          
            m
            ×
            n
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle M_{m\times n}[GF(2^{8})]}
  
 — множество матриц 
  
    
      
        m
        ×
        n
      
    
    {\displaystyle m\times n}
  
 над 
  
    
      
         
        G
        F
        (
        
          2
          
            8
          
        
        )
        .
      
    
    {\displaystyle \ GF(2^{8}).}
  

  
    
      
         
        c
        i
        r
        (
        
          a
          
            0
          
        
        ,
        
          a
          
            1
          
        
        ,
        .
        .
        .
        ,
        
          a
          
            m
            −
            1
          
        
        )
      
    
    {\displaystyle \ cir(a_{0},a_{1},...,a_{m-1})}
  
 — циркулянтная матрица 
  
    
      
        m
        ×
        m
      
    
    {\displaystyle m\times m}
  
, первая строка которой состоит из элементов 
  
    
      
         
        
          a
          
            0
          
        
        ,
        
          a
          
            1
          
        
        ,
        .
        .
        .
        ,
        
          a
          
            m
            −
            1
          
        
        ,
      
    
    {\displaystyle \ a_{0},a_{1},...,a_{m-1},}
  
 то есть:

  
    
      
        c
        i
        r
        (
        
          a
          
            0
          
        
        ,
        
          a
          
            1
          
        
        ,
        .
        .
        .
        ,
        
          a
          
            m
            −
            1
          
        
        )
        ≡
        
          
            [
            
              
                
                  
                    a
                    
                      0
                    
                  
                
                
                  
                    a
                    
                      1
                    
                  
                
                
                  …
                
                
                  
                    a
                    
                      m
                      −
                      1
                    
                  
                
              
              
                
                  
                    a
                    
                      m
                      −
                      1
                    
                  
                
                
                  
                    a
                    
                      0
                    
                  
                
                
                  …
                
                
                  
                    a
                    
                      m
                      −
                      2
                    
                  
                
              
              
                
                  ⋮
                
                
                  ⋮
                
                
                  ⋱
                
                
                  ⋮
                
              
              
                
                  
                    a
                    
                      1
                    
                  
                
                
                  
                    a
                    
                      2
                    
                  
                
                
                  …
                
                
                  
                    a
                    
                      0
                    
                  
                
              
            
            ]
          
        
        ,
      
    
    {\displaystyle cir(a_{0},a_{1},...,a_{m-1})\equiv {\begin{bmatrix}a_{0}&a_{1}&\dots &a_{m-1}\\a_{m-1}&a_{0}&\dots &a_{m-2}\\\vdots &\vdots &\ddots &\vdots \\a_{1}&a_{2}&\dots &a_{0}\\\end{bmatrix}},}
  

или просто 
  
    
      
         
        c
        i
        r
        (
        
          a
          
            0
          
        
        ,
        
          a
          
            1
          
        
        ,
        .
        .
        .
        ,
        
          a
          
            m
            −
            1
          
        
        )
        =
        c
        ⇔
        
          c
          
            i
            j
          
        
        =
        
          a
          
            (
            j
            −
            i
            )
            m
            o
            d
            m
          
        
        ,
        0
        ≤
        i
        ,
        j
        ≤
        m
        −
        1.
      
    
    {\displaystyle \ cir(a_{0},a_{1},...,a_{m-1})=c\Leftrightarrow c_{ij}=a_{(j-i)modm},0\leq i,j\leq m-1.}
  


=== Формат данных ===
Whirlpool построен на специальном блочном шифре 
  
    
      
        W
      
    
    {\displaystyle W}
  
, который работает с 512-битными данными.
В преобразованиях промежуточный результат вычисления хеша называется хеш-состоянием или просто состоянием. При вычислениях состояние обычно представляется матрицей состояния. Для Whirlpool это матрица в 
  
    
      
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle M_{8\times 8}[GF(2^{8})]}
  
. Следовательно, 512-битные блоки данных должны быть преобразованы в этот формат перед дальнейшими вычислениями. Это достигается введением функции 
  
    
      
         
        μ
      
    
    {\displaystyle \ \mu }
  
:

  
    
      
        μ
        :
        G
        F
        (
        
          2
          
            8
          
        
        
          )
          
            64
          
        
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        ,
        
        μ
        (
        a
        )
        =
        b
        ⇔
        
          b
          
            i
            j
          
        
        =
        
          a
          
            8
            i
            +
            j
          
        
        ,
        0
        ≤
        i
        ,
        j
        ≤
        7.
      
    
    {\displaystyle \mu :GF(2^{8})^{64}\to M_{8\times 8}[GF(2^{8})],\qquad \mu (a)=b\Leftrightarrow b_{ij}=a_{8i+j},0\leq i,j\leq 7.}
  

Проще говоря, заполнение матрицы состояния данными происходит построчно. При этом каждый байт матрицы представляет собой соответствующий многочлен в 
  
    
      
         
        G
        F
        (
        
          2
          
            8
          
        
        )
      
    
    {\displaystyle \ GF(2^{8})}
  
.


=== Преобразования ===


==== Нелинейное преобразование ====
  
    
      
        γ
      
    
    {\displaystyle \gamma }
  
 (S-box)
Функция 
  
    
      
        γ
        :
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle \gamma :M_{8\times 8}[GF(2^{8})]\to M_{8\times 8}[GF(2^{8})]}
  
 состоит из параллельного применения блока подстановки (S-box) 
  
    
      
        S
        :
        G
        F
        (
        
          2
          
            8
          
        
        )
        →
        G
        F
        (
        
          2
          
            8
          
        
        )
        ,
        x
        →
        S
        [
        x
        ]
      
    
    {\displaystyle S:GF(2^{8})\to GF(2^{8}),x\to S[x]}
  
 ко всем байтам матрицы состояния:

  
    
      
        γ
        (
        a
        )
        =
        b
        ⇔
        
          b
          
            i
            j
          
        
        =
        S
        [
        
          a
          
            i
            j
          
        
        ]
        ,
        0
        ≤
        i
        ,
        j
        ≤
        7.
      
    
    {\displaystyle \gamma (a)=b\Leftrightarrow b_{ij}=S[a_{ij}],0\leq i,j\leq 7.}
  

Блок подстановки описывается следующей таблицей замен:


==== Циклическая перестановка ====
  
    
      
        π
      
    
    {\displaystyle \pi }
  

Перестановка 
  
    
      
        π
        :
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle \pi :M_{8\times 8}[GF(2^{8})]\to M_{8\times 8}[GF(2^{8})]}
  
 циклически сдвигает каждый столбец матрицы состояния так, что столбец 
  
    
      
        j
      
    
    {\displaystyle j}
  
 сдвигается вниз на 
  
    
      
        j
      
    
    {\displaystyle j}
  
 позиций:

  
    
      
        π
        (
        a
        )
        =
        b
        ⇔
        
          b
          
            i
            j
          
        
        =
        
          a
          
            (
            i
            −
            j
            )
            m
            o
            d
            8
            ,
            j
          
        
        ,
        0
        ≤
        i
        ,
        j
        ≤
        7.
      
    
    {\displaystyle \pi (a)=b\Leftrightarrow b_{ij}=a_{(i-j)mod8,j},0\leq i,j\leq 7.}
  

Задача данного преобразования — перемешать байты строк матрицы состояния между собой.


==== Линейная диффузия ====
  
    
      
        θ
      
    
    {\displaystyle \theta }
  

Линейная диффузия 
  
    
      
        θ
        :
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle \theta :M_{8\times 8}[GF(2^{8})]\to M_{8\times 8}[GF(2^{8})]}
  
 — это линейное преобразование, матрицей которого является MDS-матрица 
  
    
      
         
        C
        =
        c
        i
        r
        (
        
          01
          
            x
          
        
        ,
        
          01
          
            x
          
        
        ,
        
          04
          
            x
          
        
        ,
        
          01
          
            x
          
        
        ,
        
          08
          
            x
          
        
        ,
        
          05
          
            x
          
        
        ,
        
          02
          
            x
          
        
        ,
        
          09
          
            x
          
        
        )
      
    
    {\displaystyle \ C=cir(01_{x},01_{x},04_{x},01_{x},08_{x},05_{x},02_{x},09_{x})}
  
, то есть:

  
    
      
        C
        =
        c
        i
        r
        (
        
          01
          
            x
          
        
        ,
        
          01
          
            x
          
        
        ,
        
          04
          
            x
          
        
        ,
        
          01
          
            x
          
        
        ,
        
          08
          
            x
          
        
        ,
        
          05
          
            x
          
        
        ,
        
          02
          
            x
          
        
        ,
        
          09
          
            x
          
        
        )
        =
        
          
            [
            
              
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
              
              
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
              
              
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
              
              
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
              
              
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
              
              
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
              
              
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
              
              
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    04
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
                
                  
                    08
                    
                      x
                    
                  
                
                
                  
                    05
                    
                      x
                    
                  
                
                
                  
                    02
                    
                      x
                    
                  
                
                
                  
                    09
                    
                      x
                    
                  
                
                
                  
                    01
                    
                      x
                    
                  
                
              
            
            ]
          
        
        ,
      
    
    {\displaystyle C=cir(01_{x},01_{x},04_{x},01_{x},08_{x},05_{x},02_{x},09_{x})={\begin{bmatrix}01_{x}&01_{x}&04_{x}&01_{x}&08_{x}&05_{x}&02_{x}&09_{x}\\09_{x}&01_{x}&01_{x}&04_{x}&01_{x}&08_{x}&05_{x}&02_{x}\\02_{x}&09_{x}&01_{x}&01_{x}&04_{x}&01_{x}&08_{x}&05_{x}\\05_{x}&02_{x}&09_{x}&01_{x}&01_{x}&04_{x}&01_{x}&08_{x}\\08_{x}&05_{x}&02_{x}&09_{x}&01_{x}&01_{x}&04_{x}&01_{x}\\01_{x}&08_{x}&05_{x}&02_{x}&09_{x}&01_{x}&01_{x}&04_{x}\\04_{x}&01_{x}&08_{x}&05_{x}&02_{x}&09_{x}&01_{x}&01_{x}\\01_{x}&04_{x}&01_{x}&08_{x}&05_{x}&02_{x}&09_{x}&01_{x}\\\end{bmatrix}},}
  

так что

  
    
      
        θ
        (
        a
        )
        =
        b
        ⇔
        b
        =
        a
        ⋅
        C
        .
      
    
    {\displaystyle \theta (a)=b\Leftrightarrow b=a\cdot C.}
  

Другими словами, матрица состояния умножается справа на матрицу 
  
    
      
         
        C
      
    
    {\displaystyle \ C}
  
. Напомним, что операции сложения и умножения элементов матриц производятся в 
  
    
      
         
        G
        F
        (
        
          2
          
            8
          
        
        )
      
    
    {\displaystyle \ GF(2^{8})}
  
.
MDS-матрица — это такая матрица над конечным полем 
  
    
      
         
        K
      
    
    {\displaystyle \ K}
  
, что если взять её в качестве матрицы линейного преобразования 
  
    
      
         
        f
        (
        x
        )
        =
        (
        M
        D
        S
        )
        x
      
    
    {\displaystyle \ f(x)=(MDS)x}
  
 из пространства 
  
    
      
         
        
          K
          
            n
          
        
      
    
    {\displaystyle \ K^{n}}
  
 в пространство 
  
    
      
         
        
          K
          
            m
          
        
      
    
    {\displaystyle \ K^{m}}
  
, то любые два вектора из пространства 
  
    
      
         
        
          K
          
            n
            +
            m
          
        
      
    
    {\displaystyle \ K^{n+m}}
  
 вида 
  
    
      
         
        (
        x
        ,
        f
        (
        x
        )
        )
      
    
    {\displaystyle \ (x,f(x))}
  
 будут иметь как минимум 
  
    
      
         
        m
        +
        1
      
    
    {\displaystyle \ m+1}
  
 различий в компонентах. То есть набор векторов вида 
  
    
      
         
        (
        x
        ,
        f
        (
        x
        )
        )
      
    
    {\displaystyle \ (x,f(x))}
  
 образует код, обладающий свойством максимальной разнесённости (англ. Maximum Distance Separable code). Таким кодом является, например, код Рида-Соломона.
В Whirlpool свойство максимальной разнесённости MDS-матрицы означает, что общее количество меняющихся байт вектора 
  
    
      
         
        x
      
    
    {\displaystyle \ x}
  
 и вектора 
  
    
      
         
        f
        (
        x
        )
        =
        (
        M
        D
        S
        )
        x
      
    
    {\displaystyle \ f(x)=(MDS)x}
  
 не меньше 
  
    
      
         
        8
        +
        1
        =
        9
      
    
    {\displaystyle \ 8+1=9}
  
. Другими словами, любое изменение только одного байта 
  
    
      
         
        x
      
    
    {\displaystyle \ x}
  
 приводит к изменению всех 8 байтов 
  
    
      
         
        f
        (
        x
        )
      
    
    {\displaystyle \ f(x)}
  
. В этом и состоит задача линейной диффузии.
Как уже упоминалось выше, MDS-матрица в последней (третьей) версии Whirlpool была изменена благодаря статье Taizo Shirai и Kyoji Shibutani. Они проанализировали MDS-матрицу второй версии Whirlpool и указали на возможность повышения устойчивости Whirlpool к дифференциальному криптоанализу. Также они предложили 224 кандидата на место новой MDS-матрицы. Из этого списка авторы Whirlpool выбрали вариант, наиболее легко реализуемый в аппаратном обеспечении.


==== Добавление ключа ====
  
    
      
        σ
        [
        k
        ]
      
    
    {\displaystyle \sigma [k]}
  

Функция добавления ключа 
  
    
      
        σ
        [
        k
        ]
        :
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle \sigma [k]:M_{8\times 8}[GF(2^{8})]\to M_{8\times 8}[GF(2^{8})]}
  
 представляет собой побитовое сложение (XOR) матриц состояния 
  
    
      
         
        a
      
    
    {\displaystyle \ a}
  
 и ключа 
  
    
      
        k
        ∈
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle k\in M_{8\times 8}[GF(2^{8})]}
  
:

  
    
      
        σ
        [
        k
        ]
        (
        a
        )
        =
        b
        ⇔
        
          b
          
            i
            ,
            j
          
        
        =
        
          a
          
            i
            ,
            j
          
        
        ⊕
        
          k
          
            i
            ,
            j
          
        
        ,
        0
        ≤
        i
        ,
        j
        ≤
        7.
      
    
    {\displaystyle \sigma [k](a)=b\Leftrightarrow b_{i,j}=a_{i,j}\oplus k_{i,j},0\leq i,j\leq 7.}
  


==== Константы раунда ====
  
    
      
        
          c
          
            r
          
        
      
    
    {\displaystyle c^{r}}
  

В каждом раунде 
  
    
      
         
        r
        ,
        r
        >
        0
      
    
    {\displaystyle \ r,r>0}
  
 используется матрица констант 
  
    
      
        
          c
          
            r
          
        
        ∈
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle c^{r}\in M_{8\times 8}[GF(2^{8})]}
  
, такая, что:

  
    
      
        
          c
          
            0
            j
          
          
            r
          
        
        ≡
        S
        [
        8
        (
        r
        −
        1
        )
        +
        j
        ]
        ,
        
        0
        ≤
        j
        ≤
        7
        ,
      
    
    {\displaystyle c_{0j}^{r}\equiv S[8(r-1)+j],\qquad 0\leq j\leq 7,}
  

  
    
      
        
          c
          
            i
            j
          
          
            r
          
        
        ≡
        0
        ,
        
        
        
        
        1
        ≤
        i
        ≤
        7
        ,
        0
        ≤
        j
        ≤
        7.
      
    
    {\displaystyle c_{ij}^{r}\equiv 0,\qquad \qquad \qquad \qquad 1\leq i\leq 7,0\leq j\leq 7.}
  

Отсюда видно, что первая строка матрицы 
  
    
      
        
          c
          
            r
          
        
      
    
    {\displaystyle c^{r}}
  
 является результатом применения блока подстановки 
  
    
      
        S
      
    
    {\displaystyle S}
  
 к байтовым числам 
  
    
      
        [
        8
        (
        r
        −
        1
        )
        +
        j
        ]
        ,
        0
        ≤
        j
        ≤
        7
      
    
    {\displaystyle [8(r-1)+j],0\leq j\leq 7}
  
.
Остальные 7 строк — нулевые.


==== Функция раунда ====
  
    
      
        ρ
        [
        k
        ]
      
    
    {\displaystyle \rho [k]}
  

Для каждого раунда 
  
    
      
         
        r
      
    
    {\displaystyle \ r}
  
 функция раунда — это составное преобразование 
  
    
      
        ρ
        [
        k
        ]
        :
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle \rho [k]:M_{8\times 8}[GF(2^{8})]\to M_{8\times 8}[GF(2^{8})]}
  
, параметром 
  
    
      
        k
      
    
    {\displaystyle k}
  
 которого является матрица ключа 
  
    
      
        k
        ∈
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle k\in M_{8\times 8}[GF(2^{8})]}
  
. Описывается функция раунда следующим образом:

  
    
      
        ρ
        [
        k
        ]
        ≡
        σ
        [
        k
        ]
        ∘
        θ
        ∘
        π
        ∘
        γ
        .
      
    
    {\displaystyle \rho [k]\equiv \sigma [k]\circ \theta \circ \pi \circ \gamma .}
  


=== Расширение ключа ===
Для каждого раунда 
  
    
      
         
        r
        ,
        0
        ≤
        r
        ≤
        R
      
    
    {\displaystyle \ r,0\leq r\leq R}
  
 необходим 512-битный ключ шифрования. Для решения данной проблемы во многих алгоритмах вводится так называемая процедура расширения ключа. В Whirlpool расширение ключа реализуется следующим образом:

  
    
      
         
        
          K
          
            0
          
        
        =
        K
        ,
      
    
    {\displaystyle \ K^{0}=K,}
  

  
    
      
         
        
          K
          
            r
          
        
        =
        ρ
        [
        
          c
          
            r
          
        
        ]
        (
        
          K
          
            r
            −
            1
          
        
        )
        ,
        r
        >
        0.
      
    
    {\displaystyle \ K^{r}=\rho [c^{r}](K^{r-1}),r>0.}
  

Таким образом, из известного ключа 
  
    
      
        K
      
    
    {\displaystyle K}
  
 производится необходимая последовательность 
  
    
      
        
          K
          
            0
          
        
        ,
        .
        .
        .
        ,
        
          K
          
            R
          
        
      
    
    {\displaystyle K^{0},...,K^{R}}
  
 ключей для каждого раунда блочного шифра 
  
    
      
        W
      
    
    {\displaystyle W}
  
.


=== Блочный шифр ===
  
    
      
        W
      
    
    {\displaystyle W}
  

Специальный 512-битный блочный шифр 
  
    
      
        W
        [
        K
        ]
        :
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
        →
        
          M
          
            8
            ×
            8
          
        
        [
        G
        F
        (
        
          2
          
            8
          
        
        )
        ]
      
    
    {\displaystyle W[K]:M_{8\times 8}[GF(2^{8})]\to M_{8\times 8}[GF(2^{8})]}
  
 в качестве параметра использует 512-битный ключ 
  
    
      
        K
      
    
    {\displaystyle K}
  
 и выполняет следующую последовательность преобразований:

  
    
      
        W
        [
        K
        ]
        =
        
          (
          
            
              ◯
              
                1
              
              
                r
                =
                R
              
            
            ρ
            [
            
              K
              
                r
              
            
            ]
          
          )
        
        ∘
        σ
        [
        
          K
          
            0
          
        
        ]
        ,
      
    
    {\displaystyle W[K]=\left(\bigcirc _{1}^{r=R}\rho [K^{r}]\right)\circ \sigma [K^{0}],}
  

где ключи 
  
    
      
        
          K
          
            0
          
        
        ,
        .
        .
        .
        ,
        
          K
          
            R
          
        
      
    
    {\displaystyle K^{0},...,K^{R}}
  
 порождены описанной выше процедурой расширения ключа.
В хеш-функции Whirlpool число раундов 
  
    
      
        R
        =
        10
      
    
    {\displaystyle R=10}
  
.


=== Дополнение входного сообщения ===
Whirlpool, как и любая другая хеш-функция, должна осуществлять хеширование сообщения произвольной длины. Поскольку внутренний блок шифрования 
  
    
      
        W
      
    
    {\displaystyle W}
  
 работает с 512-битными входными сообщениями, то исходное сообщение необходимо разбить на блоки по 512 бит. При этом последний блок, который содержит конец сообщения, может оказаться неполным.
Для решения данной задачи Whirlpool использует алгоритм Меркла — Дамгора дополнения входного сообщения. Результатом дополнения сообщения 
  
    
      
        M
      
    
    {\displaystyle M}
  
 является сообщение 
  
    
      
        
          M
          ′
        
      
    
    {\displaystyle M'}
  
, длина которого кратна 512. Пусть 
  
    
      
        L
      
    
    {\displaystyle L}
  
 — длина исходного сообщения. Тогда 
  
    
      
        
          M
          ′
        
      
    
    {\displaystyle M'}
  
 получается в несколько шагов:

К концу сообщения 
  
    
      
        M
      
    
    {\displaystyle M}
  
 приписать бит «1».
Приписать 
  
    
      
        x
      
    
    {\displaystyle x}
  
 битов «0» так, чтобы длина полученной строки 
  
    
      
        L
        +
        1
        +
        x
      
    
    {\displaystyle L+1+x}
  
 была кратна 
  
    
      
        256
      
    
    {\displaystyle 256}
  
 нечетное число раз.
Наконец, приписать 256-битное представление числа 
  
    
      
        L
      
    
    {\displaystyle L}
  
.
Дополненное сообщение 
  
    
      
        
          M
          ′
        
      
    
    {\displaystyle M'}
  
 записывается в виде

  
    
      
        
          M
          ′
        
        =
        
          
            
              M
              ⏞
            
          
          
            L
          
        
        ‖
        1
        ‖
        
          
            
              
                0
                …
                0
              
              ⏞
            
          
          
            x
          
        
        ‖
        
          
            
              L
              ⏞
            
          
          
            256
          
        
      
    
    {\displaystyle M'=\overbrace {M} ^{L}\|1\|\overbrace {0\dots 0} ^{x}\|\overbrace {L} ^{256}}
  

и разбивается на 512-битные блоки для дальнейшей обработки.


=== Функция сжатия ===

В Whirlpool применяется схема хеширования Miyaguchi-Preneel.

  
    
      
         
        t
      
    
    {\displaystyle \ t}
  
 блоков 
  
    
      
        
          m
          
            i
          
        
        ,
        1
        ≤
        i
        ≤
        t
      
    
    {\displaystyle m_{i},1\leq i\leq t}
  
 дополненного сообщения 
  
    
      
        
          M
          ′
        
      
    
    {\displaystyle M'}
  
 последовательно шифруются блочным шифром 
  
    
      
        W
      
    
    {\displaystyle W}
  
:

  
    
      
         
        
          η
          
            i
          
        
        =
        μ
        (
        
          m
          
            i
          
        
        )
        ,
      
    
    {\displaystyle \ \eta _{i}=\mu (m_{i}),}
  

  
    
      
         
        
          H
          
            0
          
        
        =
        μ
        (
        I
        V
        )
        ,
      
    
    {\displaystyle \ H_{0}=\mu (IV),}
  

  
    
      
        
          H
          
            i
          
        
        =
        W
        [
        
          H
          
            i
            −
            1
          
        
        ]
        (
        
          η
          
            i
          
        
        )
        ⊕
        
          H
          
            i
            −
            1
          
        
        ⊕
        
          η
          
            i
          
        
        ,
        1
        ≤
        i
        ≤
        t
        ,
      
    
    {\displaystyle H_{i}=W[H_{i-1}](\eta _{i})\oplus H_{i-1}\oplus \eta _{i},1\leq i\leq t,}
  

где 
  
    
      
        I
        V
      
    
    {\displaystyle IV}
  
 (англ. initialization vector, вектор инициализации) — 512-битная строка, заполненная «0».


=== Вычисление хеша ===
Дайджестом для сообщения 
  
    
      
        M
      
    
    {\displaystyle M}
  
 является выходное значение 
  
    
      
        
          H
          
            t
          
        
      
    
    {\displaystyle H_{t}}
  
 функции сжатия, преобразованное обратно в 512-битную строку:

  
    
      
        W
        h
        i
        r
        l
        p
        o
        o
        l
        (
        M
        )
        ≡
        
          μ
          
            −
            1
          
        
        (
        
          H
          
            t
          
        
        )
        .
      
    
    {\displaystyle Whirlpool(M)\equiv \mu ^{-1}(H_{t}).}
  


== Криптостойкость ==
Хеш-функция 
  
    
      
        H
      
    
    {\displaystyle H}
  
 считается криптографически стойкой, если она удовлетворяет трём основным требованиям, на которых основано большинство применений хеш-функций в криптографии: необратимость, стойкость к коллизиям первого рода и стойкость к коллизиям второго рода.
Пусть 
  
    
      
        
          h
          
            n
          
        
      
    
    {\displaystyle h_{n}}
  
 — произвольная 
  
    
      
        n
      
    
    {\displaystyle n}
  
-битная подстрока 512-битного хеша Whirlpool. Авторы Whirlpool утверждают, что созданная ими хеш-функция удовлетворяет следующим требованиям криптостойкости:

Генерация коллизии требует порядка 
  
    
      
        
          2
          
            n
            
              /
            
            2
          
        
      
    
    {\displaystyle 2^{n/2}}
  
 вычислений хеша WHIRLPOOL (стойкость к коллизиям второго рода).
Для заданной 
  
    
      
        
          h
          
            n
          
        
      
    
    {\displaystyle h_{n}}
  
 поиск такого сообщения 
  
    
      
        M
      
    
    {\displaystyle M}
  
, что 
  
    
      
        H
        (
        M
        )
        =
        
          h
          
            n
          
        
      
    
    {\displaystyle H(M)=h_{n}}
  
, потребует порядка 
  
    
      
        
          2
          
            n
          
        
      
    
    {\displaystyle 2^{n}}
  
 вычислений хеша WHIRLPOOL (необратимость).
Для заданного сообщения 
  
    
      
        M
      
    
    {\displaystyle M}
  
 обнаружение другого сообщения 
  
    
      
        N
      
    
    {\displaystyle N}
  
, для которого 
  
    
      
        H
        (
        N
        )
        =
        H
        (
        M
        )
      
    
    {\displaystyle H(N)=H(M)}
  
, потребует порядка 
  
    
      
        
          2
          
            n
          
        
      
    
    {\displaystyle 2^{n}}
  
 вычислений хеша WHIRLPOOL (стойкость к коллизиям первого рода).
Невозможно обнаружить систематические корреляции между любой линейной комбинацией входных бит и любой линейной комбинацией бит хеша или предсказать, какие биты хеша изменят своё значение при изменении определённых входных бит (стойкость к линейному криптоанализу и дифференциальному криптоанализу).
К данному заявлению авторы Whirlpool добавили примечание:

Эти утверждения вытекают из значительного запаса прочности относительно всех известных атак. Тем не менее, мы понимаем, что невозможно сделать не спекулятивные утверждения о неизвестных вещах.


=== Криптоанализ ===
На сегодняшний день WHIRLPOOL устойчива ко всем видам криптоанализа. На протяжении 8 лет существования Whirlpool не было зарегистрировано ни одной атаки на неё.
Однако в 2009 году был опубликован новый способ атаки на хеш-функции — The Rebound Attack.
Первыми «подопытными» новой атаки стали хеш-функции Whirlpool и Grøstl. Результаты проведённого криптоанализа приведены в таблице.

Авторы исследования использовали следующие понятия и термины:

  
    
      
         
        I
        V
      
    
    {\displaystyle \ IV}
  
 — вектор инициализации

  
    
      
         
        M
      
    
    {\displaystyle \ M}
  
 — сообщение, подлежащее хешированию

  
    
      
         
        h
        (
        M
        ,
        I
        V
        )
      
    
    {\displaystyle \ h(M,IV)}
  
 — хеш-функция
функция сжатия 
  
    
      
         
        f
        :
        
          H
          
            t
          
        
        =
        f
        (
        
          M
          
            t
          
        
        ,
        
          H
          
            t
            −
            1
          
        
        )
        ,
        
          H
          
            0
          
        
        =
        I
        V
      
    
    {\displaystyle \ f:H_{t}=f(M_{t},H_{t-1}),H_{0}=IV}
  

Типы коллизий:

коллизия:

  
    
      
         
        I
        V
      
    
    {\displaystyle \ IV}
  
 — фиксирован

  
    
      
        f
        (
        
          M
          
            t
          
        
        ,
        I
        V
        )
        =
        f
        (
        
          M
          
            t
          
          ′
        
        ,
        I
        V
        )
        ,
        
          M
          
            t
          
        
        ≠
        
          M
          
            t
          
          ′
        
      
    
    {\displaystyle f(M_{t},IV)=f(M_{t}',IV),M_{t}\neq M_{t}'}
  

почти коллизия:

  
    
      
         
        I
        V
      
    
    {\displaystyle \ IV}
  
 — фиксирован

  
    
      
        
          f
          
            
              M
              
                t
              
            
          
        
        =
        f
        (
        
          M
          
            t
          
        
        ,
        I
        V
        )
        ,
        
          f
          
            
              M
              
                t
              
              ′
            
          
        
        =
        f
        (
        
          M
          
            t
          
          ′
        
        ,
        I
        V
        )
        ,
        
          M
          
            t
          
        
        ≠
        
          M
          
            t
          
          ′
        
      
    
    {\displaystyle f_{M_{t}}=f(M_{t},IV),f_{M_{t}'}=f(M_{t}',IV),M_{t}\neq M_{t}'}
  

небольшое число бит хешей 
  
    
      
        
          f
          
            
              M
              
                t
              
            
          
        
      
    
    {\displaystyle f_{M_{t}}}
  
 и 
  
    
      
        
          f
          
            
              M
              
                t
              
              ′
            
          
        
      
    
    {\displaystyle f_{M_{t}'}}
  
 различны
полусвободная коллизия:

  
    
      
        f
        (
        
          M
          
            t
          
        
        ,
        
          H
          
            t
            −
            1
          
        
        )
        =
        f
        (
        
          M
          
            t
          
          ′
        
        ,
        
          H
          
            t
            −
            1
          
        
        )
        ,
        
          M
          
            t
          
        
        ≠
        
          M
          
            t
          
          ′
        
      
    
    {\displaystyle f(M_{t},H_{t-1})=f(M_{t}',H_{t-1}),M_{t}\neq M_{t}'}
  

свободная коллизия:

  
    
      
        f
        (
        
          M
          
            t
          
        
        ,
        
          H
          
            t
            −
            1
          
        
        )
        =
        f
        (
        
          M
          
            t
          
          ′
        
        ,
        
          H
          
            t
            −
            1
          
          ′
        
        )
        ,
        
          M
          
            t
          
        
        ≠
        
          M
          
            t
            −
            1
          
          ′
        
        ,
        
          H
          
            t
          
        
        ≠
        
          H
          
            t
            −
            1
          
          ′
        
      
    
    {\displaystyle f(M_{t},H_{t-1})=f(M_{t}',H_{t-1}'),M_{t}\neq M_{t-1}',H_{t}\neq H_{t-1}'}
  

Как видно из таблицы, сгенерировать коллизию для Whirlpool удалось лишь для её «урезанного» варианта в 4.5 раунда. К тому же сложность необходимых вычислений довольно высока.


== Применение ==
Whirlpool — свободно распространяемая хеш-функция. Поэтому она находит широкое применение в открытом программном обеспечении. Здесь перечислены некоторые примеры использования Whirlpool:

Jacksum — свободно распространяемая утилита для вычисления контрольных сумм
Crypto++ — свободно распространяемая C++ библиотека классов криптографических примитивов
TrueCrypt — бесплатная программа для шифрования «на лету»
FreeOTFE — свободная бесплатная программа с открытым кодом, предназначенная для шифрования «на лету».
DarkCrypt — свободно распространяемая крипто- и стеганографическая утилита в виде плагина для Total Commander


=== Примеры хешей ===
Для удобства 512 бит (64 байта) хеша Whirlpool часто представляются в виде 128-значного шестнадцатеричного числа.
Как говорилось выше, алгоритм потерпел два изменения с момента выпуска в 2000 году.
Ниже приведены примеры хешей, вычисленных по ASCII тексту панграммы The quick brown fox jumps over the lazy dog для всех трех версий Whirlpool:

Whirlpool-0("The quick brown fox jumps over the lazy dog") =
4F8F5CB531E3D49A61CF417CD133792CCFA501FD8DA53EE368FED20E5FE0248C
3A0B64F98A6533CEE1DA614C3A8DDEC791FF05FEE6D971D57C1348320F4EB42D

Whirlpool-T("The quick brown fox jumps over the lazy dog") =
3CCF8252D8BBB258460D9AA999C06EE38E67CB546CFFCF48E91F700F6FC7C183
AC8CC3D3096DD30A35B01F4620A1E3A20D79CD5168544D9E1B7CDF49970E87F1

Whirlpool("The quick brown fox jumps over the lazy dog") =
B97DE512E91E3828B40D2B0FDCE9CEB3C4A71F9BEA8D88E75C4FA854DF36725F
D2B52EB6544EDCACD6F8BEDDFEA403CB55AE31F03AD62A5EF54E42EE82C3FB35

Даже небольшое изменение исходного текста сообщения (в данном случае подменяется одна буква: символ «d» заменяется на символ «e») приводит к полному изменению хеша:

Whirlpool-0("The quick brown fox jumps over the lazy eog") =
228FBF76B2A93469D4B25929836A12B7D7F2A0803E43DABA0C7FC38BC11C8F2A
9416BBCF8AB8392EB2AB7BCB565A64AC50C26179164B26084A253CAF2E012676

Whirlpool-T("The quick brown fox jumps over the lazy eog") =
C8C15D2A0E0DE6E6885E8A7D9B8A9139746DA299AD50158F5FA9EECDDEF744F9
1B8B83C617080D77CB4247B1E964C2959C507AB2DB0F1F3BF3E3B299CA00CAE3

Whirlpool("The quick brown fox jumps over the lazy eog") =
C27BA124205F72E6847F3E19834F925CC666D0974167AF915BB462420ED40CC5
0900D85A1F923219D832357750492D5C143011A76988344C2635E69D06F2D38C

Добавление символов в строку, конкатенация строк и другие изменения также влияют на результат.
Примеры хешей для «нулевой» строки:

Whirlpool-0("") =
B3E1AB6EAF640A34F784593F2074416ACCD3B8E62C620175FCA0997B1BA23473
39AA0D79E754C308209EA36811DFA40C1C32F1A2B9004725D987D3635165D3C8

Whirlpool-T("") =
470F0409ABAA446E49667D4EBE12A14387CEDBD10DD17B8243CAD550A089DC0F
EEA7AA40F6C2AAAB71C6EBD076E43C7CFCA0AD32567897DCB5969861049A0F5A

Whirlpool("") =
19FA61D75522A4669B44E39C1D2E1726C530232130D407F89AFEE0964997F7A7
3E83BE698B288FEBCF88E3E03C4F0757EA8964E59B63D93708B138CC42A66EB3


=== Примеры в программировании ===


== Примечания ==


== Ссылки ==
Whirlpool homepage (англ.). — главная страница Whirlpool. Дата обращения: 25 июня 2019. Архивировано 29 ноября 2017 года.


=== Стандарты ===
The ISO/IEC 10118-3:2004 standard (англ.). — стандарт ISO/IEC 10118-3:2004. Дата обращения: 25 июня 2019.
NESSIE (англ.). — англ. New European Schemes for Signatures, Integrity and Encryption, новые европейские проекты по цифровой подписи, целостности и шифрованию. Дата обращения: 25 июня 2019.
Portfolio of recommended cryptographic primitives (англ.). — перечень рекомендованных к использованию криптографических функций NESSIE. Дата обращения: 25 июня 2019.


=== Программные реализации ===
A Java implementation of all three revisions of Whirlpool (англ.). — реализация всех трех модификаций Whirlpool на языке программирования Java. Дата обращения: 15 ноября 2009. Архивировано 29 февраля 2012 года.
A Matlab Implementation of the Whirlpool Hashing Function (англ.). — реализация Whirlpool в пакете Matlab. Дата обращения: 15 ноября 2009. Архивировано 29 февраля 2012 года.
Perl Whirlpool module at CPAN (англ.). — модуль Whirlpool на языке Perl в CPAN.
Ruby Whirlpool library (англ.). — библиотека Ruby с реализацией Whirlpool. Дата обращения: 15 ноября 2009. Архивировано 29 февраля 2012 года.


=== Аппаратные реализации ===
Efficient architecture and hardware implementation of the Whirlpool hash function (англ.). — Эффективная аппаратная реализация Whirlpool. Статья IEEE Transactions on Consumer Electronics. Дата обращения: 18 ноября 2009. Архивировано 29 февраля 2012 года.
High-Speed Parallel Architecture of the Whirlpool Hash Function (англ.). — Высокоскоростная параллельная архитектура Whirlpool. Статья журнала International Journal of Advanced Science and Technology, выпуск 7, Июнь, 2009. Дата обращения: 18 ноября 2009. Архивировано 29 февраля 2012 года.